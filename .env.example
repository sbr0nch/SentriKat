# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║  SentriKat - Environment Configuration                                     ║
# ║                                                                            ║
# ║  QUICK START:                                                              ║
# ║    1. Copy this file:       cp .env.example .env                           ║
# ║    2. Set SECRET_KEY:       Any random string (see generator command below) ║
# ║    3. Set DB_PASSWORD:      A secure password (must match DATABASE_URL)     ║
# ║    4. Start SentriKat:      docker compose up -d                           ║
# ║    5. Open browser:         http://localhost (default admin/admin)          ║
# ║                                                                            ║
# ║  IMPORTANT: Every field marked (REQUIRED) must be set before first run.    ║
# ║  Fields marked (OPTIONAL) have sensible defaults and can be changed later. ║
# ╚══════════════════════════════════════════════════════════════════════════════╝


# ============================================================================
# 1. SECURITY KEYS (REQUIRED)
# ============================================================================
# These keys protect your sessions and encrypted data. Generate unique values!

# SECRET_KEY - Signs session cookies and CSRF tokens (REQUIRED)
# WHY: Without this, anyone could forge admin sessions. Change from default!
# HOW: Run this command to generate a secure key:
#      python3 -c "import secrets; print(secrets.token_hex(32))"
# EXAMPLE: SECRET_KEY=a3f8b2c1d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0
SECRET_KEY=your-secret-key-here-change-in-production

# ENCRYPTION_KEY - Encrypts sensitive settings in the database (REQUIRED)
# WHY: SMTP passwords, API keys stored in DB are encrypted with this key.
#      If you lose this key, encrypted settings must be re-entered.
# HOW: Run this command to generate a Fernet key:
#      python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# EXAMPLE: ENCRYPTION_KEY=dGhpcyBpcyBhIHRlc3Qga2V5IGZvciBkZW1v...
ENCRYPTION_KEY=your-fernet-encryption-key-here


# ============================================================================
# 2. DATABASE (REQUIRED)
# ============================================================================
# SentriKat uses PostgreSQL. The 'db' service is provided by docker-compose.

# DATABASE_URL - Full PostgreSQL connection string (REQUIRED)
# FORMAT: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
# NOTE: The password here MUST match DB_PASSWORD below exactly.
# DEFAULT HOST: 'db' refers to the PostgreSQL container in docker-compose.
DATABASE_URL=postgresql://sentrikat:CHANGE_THIS_PASSWORD@db:5432/sentrikat

# DB_PASSWORD - PostgreSQL password for the 'sentrikat' user (REQUIRED)
# WHY: Docker-compose uses this to initialize the PostgreSQL container.
# NOTE: Must be identical to the password in DATABASE_URL above!
DB_PASSWORD=CHANGE_THIS_PASSWORD


# ============================================================================
# 3. APPLICATION URL & HOSTNAME (REQUIRED for production)
# ============================================================================

# SERVER_NAME - Your server's hostname (REQUIRED for production)
# WHY: Used by nginx for the server_name directive and SSL certificate matching.
# EXAMPLES: sentrikat.yourcompany.com, vuln.internal.corp, 192.168.1.100
SERVER_NAME=sentrikat.yourcompany.com

# SENTRIKAT_URL - Full public URL including protocol (REQUIRED for production)
# WHY: Used in email alert links, webhook payloads, and API documentation.
#      Users click these links from email notifications to go to the right page.
# EXAMPLES: https://sentrikat.yourcompany.com, http://192.168.1.100:8080
SENTRIKAT_URL=https://sentrikat.yourcompany.com


# ============================================================================
# 4. NGINX REVERSE PROXY (OPTIONAL - defaults work for HTTP)
# ============================================================================
# SentriKat ships with nginx as a reverse proxy. These settings control it.

# HTTP_PORT / HTTPS_PORT - Ports nginx listens on (OPTIONAL)
# WHY: Change if ports 80/443 are already used by another service.
# DEFAULT: 80 for HTTP, 443 for HTTPS
HTTP_PORT=80
HTTPS_PORT=443

# NGINX_TEMPLATE - Which nginx config template to use (OPTIONAL)
# OPTIONS:
#   nginx.conf.template         - HTTP only (no SSL, good for testing/internal)
#   nginx-ssl.conf.template     - HTTPS with SSL certificates (recommended for production)
# DEFAULT: nginx.conf.template (HTTP)
NGINX_TEMPLATE=nginx.conf.template

# --- SSL Certificate Settings (only needed with nginx-ssl.conf.template) ---
#
# SSL_CERT_PATH - Directory containing your SSL certificate files
# SSL_CERT_FILE - Certificate filename (PEM format)
# SSL_KEY_FILE  - Private key filename (PEM format)
# SSL_CHAIN_FILE - Intermediate chain (optional, if separate from cert)
#
# EXAMPLE with Let's Encrypt:
#   SSL_CERT_PATH=/etc/letsencrypt/live/sentrikat.yourcompany.com
#   SSL_CERT_FILE=fullchain.pem
#   SSL_KEY_FILE=privkey.pem
#
# EXAMPLE with separate cert + chain:
#   SSL_CERT_PATH=/etc/nginx/ssl
#   SSL_CERT_FILE=server.crt
#   SSL_KEY_FILE=server.key
#   SSL_CHAIN_FILE=ca-bundle.crt
#
# SSL_CERT_PATH=/etc/ssl/certs
# SSL_CERT_FILE=fullchain.pem
# SSL_KEY_FILE=privkey.pem


# ============================================================================
# 5. ENVIRONMENT MODE (OPTIONAL)
# ============================================================================

# SENTRIKAT_ENV - Controls production security features (OPTIONAL)
# OPTIONS:
#   production  - Disables development shortcuts, enforces security (recommended)
#   development - Allows dev license key, relaxed security (local testing only)
# DEFAULT: production
SENTRIKAT_ENV=production

# FLASK_ENV - Flask framework environment (OPTIONAL)
# OPTIONS: production, development
# DEFAULT: production
FLASK_ENV=production

# SESSION_COOKIE_SECURE - Only send cookies over HTTPS (OPTIONAL)
# WHY: Prevents session cookies from being sent over plain HTTP (security).
# SET TO: true when using HTTPS, false when testing with HTTP only.
# DEFAULT: true
SESSION_COOKIE_SECURE=true

# FORCE_HTTPS - Redirect all HTTP requests to HTTPS (OPTIONAL)
# WHY: Ensures all traffic is encrypted. Disable if terminating SSL elsewhere.
# DEFAULT: true
FORCE_HTTPS=true


# ============================================================================
# 6. VULNERABILITY DATA SYNC (OPTIONAL)
# ============================================================================
# SentriKat automatically syncs vulnerability data from CISA KEV daily.

# SYNC_HOUR / SYNC_MINUTE - When to run the daily sync (UTC, 24-hour format)
# WHY: Schedule sync during off-hours to minimize impact on performance.
# DEFAULT: 2:00 AM UTC
SYNC_HOUR=2
SYNC_MINUTE=0


# ============================================================================
# 7. NVD API KEY (OPTIONAL but recommended)
# ============================================================================
# The NVD (National Vulnerability Database) API enriches CVE data with CVSS
# scores and enables product search by CPE (Common Platform Enumeration).

# NVD_API_KEY - Free API key from NIST (OPTIONAL)
# WHY: Without a key, you're limited to 5 requests per 30 seconds.
#      With a key, you get 50 requests per 30 seconds (10x faster).
# HOW: Sign up at https://nvd.nist.gov/developers/request-an-api-key
#      (Free, takes ~5 minutes, key arrives by email)
# USED FOR:
#   - Product search in the "Add Product" dialog
#   - CVSS score enrichment during vulnerability sync
#   - CPE matching for accurate vulnerability detection
# NOTE: Can also be configured via the web UI at Settings > Sync Settings
# NVD_API_KEY=your-nvd-api-key-here


# ============================================================================
# 8. LICENSE (OPTIONAL - runs in Demo mode without a license)
# ============================================================================
# Without a license, SentriKat runs in Demo mode with these limits:
#   - 1 user, 1 organization, 50 products, 5 agents
#
# A Professional license unlocks:
#   - Unlimited users, organizations, and products
#   - 10+ agents (expandable with agent packs)
#   - LDAP / Active Directory / SAML SSO authentication
#   - Email alerts and webhook integrations (Slack, Teams, Discord)
#   - SIEM / Syslog forwarding
#   - White-label branding
#   - Compliance reporting
#   - Backup & restore
#
# Purchase at: https://sentrikat.com/pricing

# SENTRIKAT_INSTALLATION_ID - Unique ID for this installation (IMPORTANT!)
# WHY: Your license is locked to this ID. Generate it ONCE and never change it.
#      If you change it after activation, your license will stop working.
# HOW: Generate with:
#      python3 -c "import uuid; print(f'SK-INST-{uuid.uuid4().hex[:32].upper()}')"
# NOTE: If left blank, an ID is auto-generated on first run and stored in the DB.
#       For Docker, set it here so it persists across container rebuilds.
SENTRIKAT_INSTALLATION_ID=

# SENTRIKAT_LICENSE - Your Professional license key (OPTIONAL)
# HOW: Paste the full license key from your purchase confirmation email.
#      Can also be activated via the web UI at Settings > License.
# SENTRIKAT_LICENSE=your-license-key-here

# SENTRIKAT_LICENSE_SERVER - License server URL (usually not needed)
# Default: https://license.sentrikat.com/api
# Also accessible via api.sentrikat.com or portal.sentrikat.com
# Only set if self-hosting the SentriKat-web license server:
# SENTRIKAT_LICENSE_SERVER=https://license.sentrikat.com/api

# License verification public key (usually not needed - built into the app)
# Only set if using a custom license portal:
# SENTRIKAT_LICENSE_PUBLIC_KEY_FILE=/path/to/portal_public_key.pem


# ============================================================================
# 9. EMAIL / SMTP (OPTIONAL - for alert notifications)
# ============================================================================
# Configure SMTP to receive email alerts for new critical CVEs, health check
# failures, and daily vulnerability digest reports.
#
# Can also be configured via the web UI at Settings > Email & Alerts.
# Web UI settings override these environment variables.

# SMTP_HOST - Mail server hostname (OPTIONAL)
# EXAMPLES: smtp.gmail.com, smtp.office365.com, mail.yourcompany.com
# SMTP_HOST=smtp.yourcompany.com

# SMTP_PORT - Mail server port (OPTIONAL)
# COMMON PORTS: 587 (TLS/STARTTLS, recommended), 465 (SSL), 25 (unencrypted)
# DEFAULT: 587
# SMTP_PORT=587

# SMTP_USERNAME - Authentication username (OPTIONAL)
# Usually your email address or a service account.
# SMTP_USERNAME=alerts@yourcompany.com

# SMTP_PASSWORD - Authentication password (OPTIONAL)
# TIP: For Gmail/Google Workspace, use an App Password, not your regular password.
#      For Office 365, you may need an App Password if MFA is enabled.
# SMTP_PASSWORD=your-smtp-password

# SMTP_USE_TLS - Use STARTTLS encryption (OPTIONAL)
# DEFAULT: true (recommended for port 587)
# SMTP_USE_TLS=true

# SMTP_FROM_EMAIL - Sender email address shown in alerts (OPTIONAL)
# SMTP_FROM_EMAIL=sentrikat-alerts@yourcompany.com

# SMTP_FROM_NAME - Sender display name (OPTIONAL)
# DEFAULT: SentriKat Alerts
# SMTP_FROM_NAME=SentriKat Alerts


# ============================================================================
# 10. PROXY (OPTIONAL - for corporate/restricted networks)
# ============================================================================
# Set these if SentriKat needs to go through a proxy to reach the internet.
# Used for: CISA KEV sync, NVD API calls, EPSS data, license validation.

# HTTP_PROXY / HTTPS_PROXY - Proxy server URL (OPTIONAL)
# FORMAT: http://[user:password@]proxy-host:port
# EXAMPLES:
#   HTTP_PROXY=http://proxy.corp.com:3128
#   HTTPS_PROXY=http://proxy.corp.com:3128
#   HTTP_PROXY=http://proxyuser:proxypass@10.0.0.1:8080
# HTTP_PROXY=http://proxy.yourcompany.com:3128
# HTTPS_PROXY=http://proxy.yourcompany.com:3128

# NO_PROXY - Hosts that should bypass the proxy (OPTIONAL)
# WHY: Internal services (database, etc.) should not go through the proxy.
# FORMAT: Comma-separated list of hostnames, domains, or IPs.
# NO_PROXY=localhost,127.0.0.1,.yourcompany.com

# VERIFY_SSL - Verify SSL certificates on outgoing requests (OPTIONAL)
# WHY: Corporate proxies with SSL inspection use custom CA certificates.
#      Set to 'false' if you get SSL certificate errors during sync.
# DEFAULT: true
# WARNING: Only disable in trusted corporate networks, never on the internet.
# VERIFY_SSL=false


# ============================================================================
# 11. ADVANCED / PERFORMANCE (OPTIONAL - defaults are fine for most setups)
# ============================================================================
# SentriKat auto-detects sensible defaults. Tune these for large deployments.
#
# SCALING GUIDE (agents = endpoints reporting inventory):
# ┌────────────────┬──────────┬──────────┬──────────────┬─────────┬─────────┐
# │ Deployment     │ Agents   │ WORKERS  │ POOL_SIZE    │ DB_POOL │ PG_MAX  │
# ├────────────────┼──────────┼──────────┼──────────────┼─────────┼─────────┤
# │ Small          │ < 100    │ 4        │ 2            │ 5       │ 100     │
# │ Medium         │ 100-1K   │ 8        │ 4 (default)  │ 10      │ 300     │
# │ Large          │ 1K-5K    │ 12       │ 8            │ 15      │ 500     │
# │ Enterprise     │ 5K-10K+  │ 16       │ 16           │ 20      │ 800     │
# └────────────────┴──────────┴──────────┴──────────────┴─────────┴─────────┘
# NOTE: Ensure the server has enough CPU cores and RAM for the chosen settings.
# Rule of thumb: 1 CPU core per 2 Gunicorn workers, 256MB RAM per worker.

# LOG_DIR - Directory for application log files (OPTIONAL)
# WHY: Change if /var/log/sentrikat is not writable or you want logs elsewhere.
# DEFAULT: /var/log/sentrikat (falls back to ./logs/ if not writable)
# LOG_DIR=/var/log/sentrikat

# --- Web Server (Gunicorn) ---

# GUNICORN_WORKERS - Number of web server worker processes (OPTIONAL)
# WHY: More workers handle more concurrent API requests from agents.
# HOW: Rule of thumb: 2 * CPU cores + 1 (auto-detected by default)
# DEFAULT: auto (min(CPU*2+1, 16))
# GUNICORN_WORKERS=8

# GUNICORN_THREADS - Threads per worker (OPTIONAL)
# WHY: Each thread handles one request. Total concurrency = workers * threads.
# DEFAULT: 4
# GUNICORN_THREADS=4

# GUNICORN_TIMEOUT - Request timeout in seconds (OPTIONAL)
# WHY: Long-running operations (CISA sync, report generation) need more time.
# DEFAULT: 120
# GUNICORN_TIMEOUT=120

# GUNICORN_LOG_LEVEL - Web server log verbosity (OPTIONAL)
# OPTIONS: debug, info, warning, error, critical
# DEFAULT: info
# GUNICORN_LOG_LEVEL=info

# --- Background Worker Pool ---

# WORKER_POOL_SIZE - Concurrent inventory job processing threads (OPTIONAL)
# WHY: Controls how many inventory jobs are processed simultaneously.
#      With 10,000 agents reporting every hour, a single worker can't keep up.
#      Multiple workers process jobs in parallel for faster throughput.
# HOW: Set to number of CPU cores available, or higher for I/O-bound workloads.
# DEFAULT: 4
# EXAMPLE: With WORKER_POOL_SIZE=8, 8 inventory jobs process at the same time.
# WORKER_POOL_SIZE=4

# --- Database Connection Pool ---

# DB_POOL_SIZE - Base connections per Gunicorn worker (OPTIONAL)
# WHY: Each worker process maintains its own connection pool.
#      Too small = connection wait timeouts under load.
#      Too large = wasted PostgreSQL connections.
# HOW: Should be >= GUNICORN_THREADS + WORKER_POOL_SIZE for the worker that
#      runs the background pool.
# DEFAULT: 10
# DB_POOL_SIZE=10

# DB_POOL_MAX_OVERFLOW - Extra burst connections per worker (OPTIONAL)
# WHY: Temporary connections created when pool is exhausted during spikes.
#      These are closed after use (not kept in pool).
# DEFAULT: 20
# DB_POOL_MAX_OVERFLOW=20

# DB_POOL_TIMEOUT - Seconds to wait for a connection from pool (OPTIONAL)
# DEFAULT: 30
# DB_POOL_TIMEOUT=30

# DB_POOL_RECYCLE - Seconds before recycling a connection (OPTIONAL)
# WHY: Prevents stale connections from being used after long idle periods.
# DEFAULT: 1800 (30 minutes)
# DB_POOL_RECYCLE=1800

# DB_STATEMENT_TIMEOUT - Max query execution time in milliseconds (OPTIONAL)
# WHY: Prevents runaway queries from blocking the database.
# DEFAULT: 60000 (60 seconds)
# DB_STATEMENT_TIMEOUT=60000

# --- PostgreSQL Server Tuning ---
# These tune the PostgreSQL container itself (not the application pool).

# PG_MAX_CONNECTIONS - Maximum simultaneous PostgreSQL connections (OPTIONAL)
# WHY: Must be >= total app connections (all workers' pools combined) + headroom.
# FORMULA: GUNICORN_WORKERS * (DB_POOL_SIZE + DB_POOL_MAX_OVERFLOW) + 10
# DEFAULT: 300
# PG_MAX_CONNECTIONS=300

# PG_SHARED_BUFFERS - PostgreSQL shared memory for caching (OPTIONAL)
# WHY: More = faster queries. Rule of thumb: 25% of total RAM (max 8GB).
# DEFAULT: 256MB
# PG_SHARED_BUFFERS=256MB

# PG_EFFECTIVE_CACHE - Expected OS cache size hint for query planner (OPTIONAL)
# WHY: Helps PostgreSQL choose better query plans. Set to 75% of total RAM.
# DEFAULT: 768MB
# PG_EFFECTIVE_CACHE=768MB

# PG_WORK_MEM - Memory per sort/hash operation (OPTIONAL)
# WHY: Higher = faster sorting/joining. But each query can use multiple.
# DEFAULT: 4MB
# PG_WORK_MEM=4MB
